<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Stock Management</title>

    <!-- ===============================
       UI STYLE (iOS 26 / Apple Style)
       =============================== -->
  <style>
    :root {
      --bg: linear-gradient(180deg, #f5f5f7 0%, #eaeaef 100%);
      --card: rgba(255,255,255,0.72);
      --blur: blur(22px);
      --text: #1c1c1e;
      --subtext: #6e6e73;
      --primary: #007aff;
      --danger: #ff3b30;
      --radius-lg: 22px;
      --radius-md: 16px;
      --shadow-soft: 0 8px 24px rgba(0,0,0,0.06);
      --shadow-card: 0 12px 32px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    h1 {
      font-size: 26px;
      margin-bottom: 12px;
    }

    h2 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    h3 {
      font-size: 17px;
      margin-bottom: 6px;
    }

    button {
      appearance: none;
      border: none;
      border-radius: 16px;
      padding: 14px 18px;
      font-size: 15px;
      font-weight: 600;
      background: var(--primary);
      color: #fff;
      box-shadow: var(--shadow-soft);
    }

    button.secondary {
      background: rgba(0,0,0,0.04);
      color: var(--text);
    }

    button.loading {
  opacity: 0.7;
  pointer-events: none;
}


    .hidden {
      display: none !important;
    }

    /* ===============================
       Layout
       =============================== */
    .app {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 16px 14px 32px;
    }

    /* ===============================
       Card (Glass)
       =============================== */
    .card {
      background: var(--card);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-card);
    }

    .muted {
      color: var(--subtext);
      font-size: 13px;
    }

    /* ===============================
   Product List
   =============================== */
#product-list {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-bottom: 20px;
}

.product-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  will-change: transform;
  gap: 12px;
  background: var(--card);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  border-radius: var(--radius-lg);
  padding: 14px 16px;
  box-shadow: var(--shadow-soft);
}

.product-card.selectable {
  cursor: pointer;
}

    .product-info {
      flex: 1;
    }

    .product-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .product-stock {
      font-size: 13px;
      color: var(--subtext);
    }

    .product-action {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(0,0,0,0.06);
      color: var(--text);
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: none;
    }

    /* ===============================
       Cart Summary
       =============================== */
    #cart-summary {
      position: sticky;
      bottom: 16px;
    }

    #cart-summary button {
      width: 100%;
      margin-top: 10px;
    }

        .cart-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ff3b30;
      color: #fff;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
    }


    /* ===============================
       Inputs (Admin)
       =============================== */
    input {
      width: 100%;
      padding: 14px 16px;
      border-radius: var(--radius-md);
      border: none;
      font-size: 15px;
      background: rgba(0,0,0,0.04);
      margin-bottom: 12px;
    }

        /* ===============================
       iOS Navigation Bar
       =============================== */
    .nav-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      margin: -16px -14px 16px;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-bottom: 1px solid rgba(0,0,0,0.04);
    }

    .nav-title {
      font-size: 17px;
      font-weight: 600;
      text-align: center;
      flex: 1;
    }

    .nav-action {
  position: relative; /* üî¥ CHANGED */
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(0,0,0,0.06);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
}


    .nav-spacer {
      width: 32px;
    }

        /* ===============================
       Empty State (Apple Style)
       =============================== */
    .empty-state {
      text-align: center;
      padding: 28px 16px;
      color: var(--subtext);
    }

    .empty-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 12px;
      border-radius: 50%;
      background: rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: var(--text);
    }

    .empty-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }

    .empty-desc {
      font-size: 13px;
      line-height: 1.4;
    }

        /* ===============================
       Admin Dashboard
       =============================== */
    .admin-section {
      margin-bottom: 24px;
    }

    .admin-section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--subtext);
      margin: 0 0 8px 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .admin-card {
      background: var(--card);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      border-radius: var(--radius-lg);
      padding: 16px;
      box-shadow: var(--shadow-card);
    }

    .admin-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }

    .admin-row:last-child {
      border-bottom: none;
    }

    .admin-row-label {
      font-size: 15px;
      font-weight: 500;
    }

    .admin-row-desc {
      font-size: 13px;
      color: var(--subtext);
      margin-top: 2px;
    }

    .admin-row-action {
      font-size: 18px;
      color: var(--subtext);
    }

        /* ===============================
       Motion & Interaction (iOS Feel)
       =============================== */

    /* Tap feedback */
    button,
    .product-card,
    .admin-card,
    .admin-row,
    .nav-action {
      transition:
        transform 0.12s ease,
        box-shadow 0.12s ease,
        background-color 0.12s ease,
        opacity 0.12s ease;
    }

    button:active,
    .product-card:active,
    .admin-card:active,
    .admin-row:active,
    .nav-action:active {
      transform: scale(0.98);
      opacity: 0.92;
    }

    /* Disabled button */
    button:disabled {
      background: rgba(0,0,0,0.12);
      color: rgba(0,0,0,0.35);
      box-shadow: none;
    }

    /* Hover hint (for desktop preview only) */
    @media (hover: hover) {
      .product-card:hover,
      .admin-row:hover {
        background: rgba(255,255,255,0.82);
      }
    }

    /* Page transition base */
    section {
      transition: opacity 0.25s ease, transform 0.25s ease;
    }

    section.hidden {
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
    }

    /* Nav action subtle feedback */
    .nav-action:active {
      background: rgba(0,0,0,0.12);
    }

        .sheet {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.25);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 50;
    }

    .sheet-card {
      width: 100%;
      max-width: 430px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-radius: 24px 24px 0 0;
      padding: 20px;
      box-shadow: var(--shadow-card);
      animation: slideUp 0.25s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

        /* ===============================
       Cart Item Control
       =============================== */
    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .cart-info {
      flex: 1;
    }

    .cart-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cart-actions button {
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 50%;
      background: rgba(0,0,0,0.06);
      color: var(--text);
      font-size: 18px;
      box-shadow: none;
    }

    .cart-actions .remove {
      color: var(--danger);
      font-weight: 700;
    }

    .admin-product-card {
  display: flex;
  gap: 12px;
  align-items: center;
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: 12px;
  box-shadow: var(--shadow-soft);
}

.admin-product-thumb {
  width: 64px;
  height: 64px;
  border-radius: 12px;
  background: rgba(0,0,0,0.06);
  background-size: cover;
  background-position: center;
  flex-shrink: 0;
}

.admin-product-info {
  flex: 1;
}

.admin-product-name {
  font-weight: 600;
  font-size: 15px;
}

.admin-product-meta {
  font-size: 13px;
  color: var(--subtext);
}

.admin-product-actions {
  font-size: 20px;
  color: var(--subtext);
}


  </style>

</head>

<body>
  <div class="app">

    <!-- ===============================
         VIEWER FLOW
         =============================== -->
    <section id="viewer-view">

            <!-- iOS Navigation Bar -->
      <!-- iOS Navigation Bar (Single Cart Source) -->
<div class="nav-bar">
  <div class="nav-action hidden" id="cart-icon">
    üß∫
    <span class="cart-badge">0</span>
  </div>

  <div class="nav-title">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>

  <div class="nav-action">‚ãØ</div>
</div>


      <h1 class="hidden">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

         <!-- Product List -->
<div id="product-list">

  <!-- Empty State (‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤) -->
  <div class="card empty-state">
    <div class="empty-icon">üì¶</div>
    <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
    <div class="empty-desc">
      ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    </div>
  </div>

  <!-- Product Card (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - UI ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ) -->
  <div class="product-card selectable hidden">
    <div class="product-info">
      <div class="product-name">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <div class="product-stock">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 120 ‡∏ä‡∏¥‡πâ‡∏ô</div>
    </div>
    <div class="product-action">‚Ä∫</div>
  </div>

</div>

      <div id="admin-product-detail-sheet" class="sheet hidden">
  <div class="sheet-card">

    <h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
    <input id="edit-product-name" />

    <label>‡∏£‡∏≤‡∏Ñ‡∏≤</label>
    <input id="edit-product-price" type="number" />

    <label>‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (URL)</label>
    <input id="edit-product-image" />

    <button id="btn-save-product">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button class="secondary" id="btn-toggle-product">‡∏õ‡∏¥‡∏î / ‡πÄ‡∏õ‡∏¥‡∏î ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <!-- üî¥ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
    <button class="secondary" id="btn-open-adjust-stock">
     ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å
    </button>
    <button class="secondary" id="btn-close-product-detail">‡∏õ‡∏¥‡∏î</button>

  </div>
</div>



        <!-- render product cards here -->
           
    </section>

    <section id="cart-view" class="hidden">
  <div class="nav-bar">
    <div class="nav-action" id="btn-back-cart">‚Äπ</div>
    <div class="nav-title">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>
    <div class="nav-spacer"></div>
  </div>

        <!-- Cart Summary -->
  <div class="card" id="cart-summary-box">
    <div><strong>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</strong></div>
    <div class="muted" id="cart-summary-text">
      -
    </div>
  </div>

  <div id="cart-items"></div>

  <button id="btn-go-order">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
</section>

    <!-- ===============================
         ORDER PREVIEW (PNG EXPORT)
         =============================== -->
    <section id="order-preview" class="hidden">

  <div class="card" id="order-sheet" style="
  padding: 32px 28px;
  margin: 24px;
  border-radius: 18px;
  background: #ffffff;
">
    <h2 style="text-align:center;margin-bottom:12px;">‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>

    <div class="muted" style="text-align:center;margin-bottom:16px;">
      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="order-date"></span>
    </div>

    <table style="width:100%;border-collapse:collapse;font-size:14px;">
      <thead>
        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);">
          <th align="left">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th align="center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th align="left">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</th>
        </tr>
      </thead>
      <tbody id="order-items"></tbody>
    </table>

    <div class="muted" style="margin-top:16px;text-align:center;">
      Generated by Stock System
    </div>
  </div>

  <button id="btn-export-png">Export PNG</button>
  <button class="secondary" id="btn-back-order">‡∏Å‡∏•‡∏±‡∏ö</button>


</section>


        <!-- ===============================
         ADMIN FLOW
         =============================== -->
    <section id="admin-login" class="hidden">
      <div class="card">
        <h2>Admin Login</h2>
        <input id="admin-password" type="password" placeholder="Password" />
        <button id="btn-admin-login">Login</button>
      </div>
    </section>

    <!-- üî¥ REPLACED: Admin Dashboard (UI Only) -->
    <section id="admin-dashboard" class="hidden">

      <!-- Admin Navigation -->
      <div class="nav-bar">
        <div class="nav-spacer"></div>
        <div class="nav-title">Admin</div>
        <div class="nav-action">‚ãØ</div>
      </div>

      <!-- ===============================
     Orders Inbox
     =============================== -->
<div class="admin-section">
  <div class="admin-section-title">Orders</div>

  <div class="admin-card">
    <div id="admin-order-list"></div>
  </div>
</div>


      <!-- ===============================
           Product Management
           =============================== -->
      <div class="admin-section">
        <div class="admin-section-title">Products</div>

        <div class="admin-card">
          <div class="admin-row">
            <div>
              <div class="admin-row-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
              <div class="admin-row-desc">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
            </div>
            <div class="admin-row-action">‚Ä∫</div>
          </div>

          <div id="admin-product-list">
            <div class="empty-state">
              <div class="empty-icon">üì¶</div>
              <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
              <div class="empty-desc">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å
              </div>
            </div>
          </div>

          <button id="btn-add-product" style="margin-top:12px;">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          </button>
        </div>
      </div>

      <!-- ===============================
           Stock Movement
           =============================== -->
      <div class="admin-section">
        <div class="admin-section-title">Stock</div>

        <div class="admin-card">
          <div class="admin-row">
            <div>
              <div class="admin-row-label">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ / ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</div>
              <div class="admin-row-desc">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏ï‡πä‡∏≠‡∏Å</div>
            </div>
            <div class="admin-row-action">‚Ä∫</div>
          </div>

          <div class="empty-state">
            <div class="empty-icon">üîÑ</div>
            <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
            <div class="empty-desc">
              ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            </div>
          </div>
        </div>
      </div>

      <!-- ===============================
           History
           =============================== -->
      <div class="admin-section">
        <div class="admin-section-title">History</div>

        <div class="admin-card">
          <div class="empty-state">
            <div class="empty-icon">üïò</div>
            <div class="empty-title">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
            <div class="empty-desc">
              ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </div>
          </div>
        </div>
      </div>

      
    </section>

     </div> <!-- üî¥ FIX: close .app -->
  
<!-- ===============================
     Add to Cart Sheet (UI Only)
     =============================== -->
<div id="add-to-cart-sheet" class="sheet hidden">
  <div class="sheet-card">
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</label>
    <input type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10" />

    <label>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</label>
    <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á" />

    <button id="btn-add-to-cart">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
<button class="secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>

  </div>
</div>

  <!-- ===============================
     Product Detail Popup (UI Only)
     =============================== -->
<div id="product-detail-sheet" class="sheet hidden">
  <div class="sheet-card">

    <h2 id="detail-name">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <p class="muted" id="detail-stock">
      ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ -
    </p>

    <div class="card" style="margin:16px 0;">
      <div class="muted">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <div id="detail-desc">
        ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
      </div>
    </div>

    <button id="btn-go-add-to-cart">‡∏™‡∏±‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <button class="secondary" id="btn-close-detail">‡∏õ‡∏¥‡∏î</button>

  </div>
</div>

<!-- ===============================
     Admin Order Detail Sheet
     =============================== -->
<div id="admin-order-detail-sheet" class="sheet hidden">
  <div class="sheet-card">

    <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>

    <p class="muted">
      Order ID: <span id="admin-order-id">-</span><br>
      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="admin-order-date">-</span>
    </p>

    <div class="card" style="margin:16px 0;">
      <div class="muted">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>

      <table style="width:100%;font-size:14px;border-collapse:collapse;">
        <thead>
          <tr style="border-bottom:1px solid rgba(0,0,0,0.1);">
            <th align="left">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th align="center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th align="right">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
            <th align="right">‡∏£‡∏ß‡∏°</th>
          </tr>
        </thead>
        <tbody id="admin-order-items"></tbody>
      </table>
    </div>

    <div class="card">
      <div class="admin-row">
        <div class="admin-row-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div class="admin-row-action">
          ‡∏ø <span id="admin-order-total">0</span>
        </div>
      </div>
    </div>

    <button id="btn-approve-order">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    <button class="secondary" id="btn-reject-order">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
    <button class="secondary" id="btn-close-admin-order">‡∏õ‡∏¥‡∏î</button>

  </div>
</div>

  <div id="admin-add-product-sheet" class="sheet hidden">
  <div class="sheet-card">

    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>

    <div id="add-product-preview"
      style="width:100%;height:180px;
      border-radius:16px;
      background:#eee;
      background-size:cover;
      background-position:center;
      margin-bottom:16px;">
    </div>

    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
    <input id="add-product-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" />

    <label>‡∏£‡∏≤‡∏Ñ‡∏≤</label>
    <input id="add-product-price" type="number" placeholder="0" />

    <label>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
    <input id="add-product-stock" type="number" placeholder="0" />

    <label>‡∏£‡∏π‡∏õ (URL)</label>
    <input id="add-product-image" placeholder="https://..." />

    <button id="btn-create-product">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <button class="secondary" id="btn-cancel-add-product">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>

  </div>
</div>

  <!-- ===============================
     Admin Stock Adjust Sheet
     =============================== -->
<div id="admin-stock-adjust-sheet" class="sheet hidden">
  <div class="sheet-card">

    <h2>‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <div class="muted" id="stock-adjust-product-name">
      ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -
    </div>

    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
    <div style="display:flex;gap:12px;margin-bottom:12px;">
      <label>
        <input type="radio" name="stock-type" value="IN" checked />
        ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤
      </label>
      <label>
        <input type="radio" name="stock-type" value="OUT" />
        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
      </label>
    </div>

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
    <input id="stock-adjust-qty" type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10" />

    <button id="btn-confirm-adjust-stock">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button class="secondary" id="btn-cancel-adjust-stock">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>

  </div>
</div>

  <!-- ===============================
       GLOBAL STATE
       =============================== -->
<script>
  const state = {
    products: [], // üî¥ FROM BACKEND ONLY
    cart: [],
    currentOrder: null,
    selectedProduct: null,
    admin: {
      loggedIn: false,
      selectedOrder: null
    }
  };
</script>


  <!-- ===============================
       API LAYER (Google Apps Script)
       =============================== -->
  <script>
  const API_ENDPOINT =
    "https://script.google.com/macros/s/AKfycby5H_jyKgM0l0XWzpzO4pBRvdfjQuXJppaNJuXrmAXN6RuDGpg0W42TmDtactLJrqMz/exec";

  const API = {
    async createOrder(items) {
      const res = await fetch(API_ENDPOINT, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          action: "createOrder",
          payload: {
            items
          }
        })
      });

      return res.json();
    },

    async fetchOrders() {
      const res = await fetch(API_ENDPOINT, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          action: "fetchOrders"
        })
      });

      return res.json();
    },

    async approveOrder(orderId, items) {
  const res = await fetch(API_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "approveOrder",
      payload: { orderId, items }
    })
  });
  return res.json();
}

    async rejectOrder(orderId) {
  return fetch(API_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "rejectOrder",
      payload: { orderId }
    })
  }).then(r => r.json());
}

</script>

  <script>
  // üî¥ ADD
  API.fetchProducts = async () => {
    const res = await fetch(API_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "fetchProducts"
      })
    });
    return res.json();
  };

    API.adjustStock = async ({ productId, qty, type }) => {
  const res = await fetch(API_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "adjustStock",
      payload: {
        productId,
        qty,
        type,
        actionBy: "admin"
      }
    })
  });

  return res.json();
};

</script>


  <!-- ===============================
       RENDER FUNCTIONS
       =============================== -->

  <script>
  async function renderAdminOrders() {
    const box = document.getElementById("admin-order-list");
    box.innerHTML = "";

    const orders = await API.fetchOrders();
    const pending = orders.filter(o => o.status === "PENDING");

    if (pending.length === 0) {
      box.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üì•</div>
          <div class="empty-title">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
        </div>`;
      return;
    }

    pending.forEach(order => {
      const div = document.createElement("div");
      div.className = "admin-row";

      div.innerHTML = `
        <div>
          <div class="admin-row-label">Order #${order.id}</div>
          <div class="admin-row-desc">
            ${order.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ¬∑
            ${new Date(order.createdAt).toLocaleString("th-TH")}
          </div>
        </div>
        <div class="admin-row-action">‚Ä∫</div>
      `;

      // üî¥ CHANGED HERE
      div.onclick = () => {
        openAdminOrderDetail(order);
      };

      box.appendChild(div);
    });
  }
</script>
  
  <script>
  function renderCartSummary() {
    const summary = document.getElementById("cart-summary-text");
    const btnOrder = document.getElementById("btn-go-order");

    const totalItems = state.cart.length;
    const totalQty = state.cart.reduce((sum, i) => sum + i.qty, 0);

    if (totalItems === 0) {
      summary.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤";
      btnOrder.disabled = true;           // üî¥ GUARD
      return;
    }

    summary.textContent =
      `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ¬∑ ‡∏£‡∏ß‡∏° ${totalQty} ‡∏ä‡∏¥‡πâ‡∏ô`;

    btnOrder.disabled = false;
  }
</script>

  <script>
 function renderProducts() {
    const list = document.getElementById("product-list");
    list.innerHTML = "";

    if (state.products.length === 0) {
      list.innerHTML = `
        <div class="card empty-state">
          <div class="empty-icon">üì¶</div>
          <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        </div>`;
      return;
    }

    state.products.forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card selectable";
      card.innerHTML = `
        <div class="product-info">
          <div class="product-name">${p.name}</div>
          <div class="product-stock">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${p.stock} ‡∏ä‡∏¥‡πâ‡∏ô</div>
        </div>
        <div class="product-action">‚Ä∫</div>
      `;

      // üî¥ CHANGED: ‡πÄ‡∏õ‡∏¥‡∏î Product Detail ‡∏Å‡πà‡∏≠‡∏ô
      card.onclick = () => openProductDetail(p);

      list.appendChild(card);
    });
  }

  function renderCartIcon() {
    const icon = document.getElementById("cart-icon");
    const badge = icon.querySelector(".cart-badge");

    const itemCount = state.cart.length; // ‚úÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"

    if (itemCount === 0) {
      icon.classList.add("hidden");
      return;
    }

    icon.classList.remove("hidden");
    badge.textContent = itemCount;
  }
</script>

 <script>
  function renderCart() {
    const box = document.getElementById("cart-items");
    box.innerHTML = "";

    // üî¥ GUARD: cart ‡∏ß‡πà‡∏≤‡∏á ‚Üí ‡∏Å‡∏•‡∏±‡∏ö viewer
    if (state.cart.length === 0) {
      document.getElementById("cart-view").classList.add("hidden");
      document.getElementById("viewer-view").classList.remove("hidden");
      renderCartIcon();
      return;
    }

    state.cart.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "card cart-item";

      div.innerHTML = `
        <div class="cart-info">
          <strong>${item.name}</strong><br/>
          ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á: ${item.user}
        </div>

        <div class="cart-actions">
          <button data-action="decrease">‚àí</button>
          <span>${item.qty}</span>
          <button data-action="increase">+</button>
          <button class="remove" data-action="remove">√ó</button>
        </div>
      `;

      div.onclick = (e) => {
        const action = e.target.getAttribute("data-action");
        if (!action) return;

        if (action === "increase") item.qty++;
        if (action === "decrease") {
          item.qty--;
          if (item.qty <= 0) state.cart.splice(index, 1);
        }
        if (action === "remove") state.cart.splice(index, 1);

        renderCart();
        renderCartIcon();
      };

      box.appendChild(div);
    });

    // üî¥ CHANGED: update summary + export button
    renderCartSummary();
    updateExportButton();
  }
</script>

  <script>
  function updateExportButton() {
    const btn = document.getElementById("btn-export-png");
    if (!btn) return;
    btn.disabled = state.cart.length === 0;
  }
</script>


  <script>
  function renderOrderSheet() {
    const body = document.getElementById("order-items");
    body.innerHTML = "";

    if (!state.currentOrder) return; // üîí GUARD

    document.getElementById("order-date").textContent =
      new Date(state.currentOrder.createdAt).toLocaleString("th-TH");

    state.currentOrder.items.forEach(item => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.name}</td>
        <td align="center">${item.qty}</td>
        <td>${item.user}</td>
      `;
      body.appendChild(tr);
    });
  }
</script>

<script>
async function renderAdminProducts() {
  const box = document.getElementById("admin-product-list");
  box.innerHTML = "";

  state.products = await API.fetchProducts();
  const products = state.products;


  if (!products || products.length === 0) {
    box.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üì¶</div>
        <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div class="empty-desc">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å</div>
      </div>
    `;
    return;
  }

  products.forEach(p => {
    const row = document.createElement("div");
    row.className = "product-card selectable admin-product-card";

    row.innerHTML = `
  <div class="product-info" style="display:flex;gap:12px;align-items:center;">
    
    <!-- ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <div class="product-thumb"
         style="
           width:56px;
           height:56px;
           border-radius:12px;
           background:#f0f0f0 url('${p.image || ""}') center/cover no-repeat;
         ">
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div>
      <div class="product-name">
        ${p.name}
        ${p.status === "INACTIVE" ? " (‡∏õ‡∏¥‡∏î‡∏Ç‡∏≤‡∏¢)" : ""}
      </div>
      <div class="product-stock muted">
        ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${p.stock} ¬∑ ‡∏ø${p.price}
      </div>
    </div>

  </div>

  <div class="product-action">‚Ä∫</div>
`;

        row.onclick = () => openAdminProductDetail(p);

    box.appendChild(row);
  });
}

</script>

  <!-- ===============================
     VIEWER FLOW LOGIC
     =============================== -->
  <script>
  const detailSheet = document.getElementById("product-detail-sheet");
  const detailName = document.getElementById("detail-name");
  const detailStock = document.getElementById("detail-stock");

  function openProductDetail(product) {
    state.selectedProduct = product;

    detailName.textContent = product.name;
    detailStock.textContent = `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô`;

    detailSheet.classList.remove("hidden");
  }

  function closeProductDetail() {
    detailSheet.classList.add("hidden");
  }

  document.getElementById("btn-close-detail").onclick = closeProductDetail;
</script>

<script>
  const sheet = document.getElementById("add-to-cart-sheet");
  const qtyInput = sheet.querySelector('input[type="number"]');
  const userInput = sheet.querySelector('input[type="text"]');
  const addBtn = document.getElementById("btn-add-to-cart"); // üî¥ CHANGED
  const cancelBtn = sheet.querySelector(".secondary");

  function openAddToCartSheet(product) {
    state.selectedProduct = product;
    qtyInput.value = "";
    userInput.value = "";
    sheet.classList.remove("hidden");
  }

    function closeSheet() {
    sheet.classList.add("hidden");
    state.selectedProduct = null;

    // üî¥ OPTIONAL: defensive clear
    qtyInput.value = "";
    userInput.value = "";
  }

 addBtn.onclick = () => {
  const qty = Number(qtyInput.value);
  const user = userInput.value.trim();

  if (!state.selectedProduct) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà");
    return;
  }
 
  if (!qty || qty <= 0 || !user) {
    alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á");
    return;
  }

  const product = state.selectedProduct;

if (qty > product.stock) {
  alert(`‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${product.stock})`);
  return;
}

  // üî¥ NORMALIZE: ‡∏´‡∏≤ item ‡πÄ‡∏î‡∏¥‡∏° (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô + ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
  const existing = state.cart.find(
    i => i.productId === product.id && i.user === user
  );

  if (existing) {
    existing.qty += qty; // ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  } else {
    state.cart.push({
      productId: product.id,
      name: product.name,
      qty,
      user
    });
  }

  closeSheet();
  renderCartIcon();
};


  cancelBtn.onclick = closeSheet;
</script>

 <script>
  // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Order Preview
  document.getElementById("btn-go-order").onclick = () => {
  if (state.cart.length === 0) return;     // üîí guard 1
  if (state.currentOrder) return;          // üîí guard 2 (‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥)
    if (state.currentOrder?.status === "PENDING") return;


  document.getElementById("cart-view").classList.add("hidden");
  document.getElementById("order-preview").classList.remove("hidden");

  for (const item of state.cart) {
     const product = state.products.find(p => p.id === item.productId);
     if (!product || product.stock < item.qty) {
       alert(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${item.name} ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠`);
       return;
     }
   } 

  createOrderFromCart();   // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  renderOrderSheet();      // ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å currentOrder
};


  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏≤‡∏Å icon
  document.getElementById("cart-icon").onclick = () => {
    if (state.cart.length === 0) return; // üîí guard

    document.getElementById("viewer-view").classList.add("hidden");
    document.getElementById("cart-view").classList.remove("hidden");

    renderCart();
  };

   // üî¥ ADD THIS: ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Cart ‚Üí Viewer
  document.getElementById("btn-back-cart").onclick = () => {
    document.getElementById("cart-view").classList.add("hidden");
    document.getElementById("viewer-view").classList.remove("hidden");
  };
   
  // ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Order ‚Üí Cart
  document.getElementById("btn-back-order").onclick = () => {
    document.getElementById("order-preview").classList.add("hidden");
    document.getElementById("cart-view").classList.remove("hidden");
  };
</script>


<script>
  document.getElementById("btn-export-png").onclick = () => {
    const exportBtn = document.getElementById("btn-export-png");
    exportBtn.classList.add("loading");

    const source = document.getElementById("order-sheet");

    // üî¥ FIX: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î scale ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°)
    const scale = 3;

    // clone DOM ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°
    const clone = source.cloneNode(true);
    clone.style.background = "#ffffff";
    clone.style.color = "#000000";
    clone.style.boxShadow = "none";
    clone.style.margin = "0";

    const rect = source.getBoundingClientRect();

    // üî¥ Safe area ‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
    const padding = 40;

    const canvas = document.createElement("canvas");
    canvas.width = (rect.width + padding * 2) * scale;
    canvas.height = (rect.height + padding * 2) * scale;

    const ctx = canvas.getContext("2d");

    // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß (‡∏Å‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™)
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.scale(scale, scale);

    const data = `
      <svg xmlns="http://www.w3.org/2000/svg" width="${rect.width}" height="${rect.height}">
        <foreignObject width="100%" height="100%">
          <div xmlns="http://www.w3.org/1999/xhtml" style="background:#fff;">
            ${new XMLSerializer().serializeToString(clone)}
          </div>
        </foreignObject>
      </svg>
    `;

    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, padding, padding);

      const link = document.createElement("a");
      link.download = "order.png";
      link.href = canvas.toDataURL("image/png");
      link.click();

      exportBtn.classList.remove("loading");

      setTimeout(() => {
        if (confirm("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
          state.cart = [];
          state.currentOrder = null;
          renderCartIcon();

          document.getElementById("order-preview").classList.add("hidden");
          document.getElementById("viewer-view").classList.remove("hidden");
        }
      }, 100);
    };

    img.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(data);
  };
</script>

<script>
  async function createOrderFromCart() {
    if (state.cart.length === 0) return;

    const snapshot = {
      id: Date.now(),
      items: JSON.parse(JSON.stringify(state.cart)),
      createdAt: new Date().toISOString(),
      status: "PENDING"
    };

    try {
      const result = await API.createOrder(snapshot.items);

      if (!result.success) {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ");
        return;
      }

      // üî¥ KEY: ‡πÄ‡∏Å‡πá‡∏ö snapshot ‡πÑ‡∏ß‡πâ render / export
      state.currentOrder = snapshot;

      // ‡∏•‡πâ‡∏≤‡∏á cart
      state.cart = [];
      renderCartIcon();

    } catch (err) {
      console.error(err);
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö");
    }
  }
</script>

  <script>
  // üî¥ ADD: ‡∏à‡∏≤‡∏Å Product Detail ‚Üí Add to Cart
  document.getElementById("btn-go-add-to-cart").onclick = () => {
    if (!state.selectedProduct) return;

    // ‡∏õ‡∏¥‡∏î detail ‡∏Å‡πà‡∏≠‡∏ô
    closeProductDetail();

    // ‡πÄ‡∏õ‡∏¥‡∏î sheet ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    openAddToCartSheet(state.selectedProduct);
  };
</script>


  <!-- ===============================
       ADMIN FLOW LOGIC
       =============================== -->
   
  <script>
  document.getElementById("btn-admin-login").onclick = async () => {
    state.admin.loggedIn = true;

    document.getElementById("admin-login").classList.add("hidden");
    document.getElementById("admin-dashboard").classList.remove("hidden");

    await renderAdminOrders();
    await renderAdminProducts(); // ‚úÖ ADD
  };

</script>

  <script>
  const adminOrderSheet = document.getElementById("admin-order-detail-sheet");
  const adminOrderItems = document.getElementById("admin-order-items");
  const adminOrderTotal = document.getElementById("admin-order-total");

  function openAdminOrderDetail(order) {
    state.admin.selectedOrder = JSON.parse(JSON.stringify(order));

    document.getElementById("admin-order-id").textContent = order.id;
    document.getElementById("admin-order-date").textContent =
      new Date(order.createdAt).toLocaleString("th-TH");

    adminOrderItems.innerHTML = "";
    let total = 0;

    state.admin.selectedOrder.items.forEach((item, index) => {
      if (!item.price) item.price = 0;

      const rowTotal = item.qty * item.price;
      total += rowTotal;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.name}</td>
        <td align="center">${item.qty}</td>
        <td align="right">
          <input type="number"
                 value="${item.price}"
                 style="width:80px;text-align:right;"
                 data-index="${index}" />
        </td>
        <td align="right" class="row-total">‡∏ø ${rowTotal}</td>
      `;

      tr.querySelector("input").oninput = (e) => {
  const price = Number(e.target.value) || 0;
  item.price = price;

  const newRowTotal = item.qty * price;
  tr.querySelector(".row-total").textContent =
    "‡∏ø " + newRowTotal.toLocaleString("th-TH");

  updateAdminTotal();
};

      adminOrderItems.appendChild(tr);
    });

    adminOrderTotal.textContent = total.toLocaleString("th-TH");
    adminOrderSheet.classList.remove("hidden");
  }

    function updateAdminTotal() {
  const total = state.admin.selectedOrder.items.reduce(
    (sum, i) => sum + (i.qty * (i.price || 0)),
    0
  );
  adminOrderTotal.textContent = total.toLocaleString("th-TH");
}


  function closeAdminOrderDetail() {
    adminOrderSheet.classList.add("hidden");
    state.admin.selectedOrder = null;
  }

  document.getElementById("btn-close-admin-order").onclick = closeAdminOrderDetail;
</script>


  <script>
document.getElementById("btn-approve-order").onclick = async () => {
  const order = state.admin.selectedOrder;
  if (!order) return;

  if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏Å‡∏™‡∏ï‡πä‡∏≠‡∏Å?")) return;

  const res = await API.approveOrder(order.id, order.items);
  if (!res.success) {
    alert(res.error || "Approve ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    return;
  }

  closeAdminOrderDetail();
  detailSheet.classList.add("hidden");

  // üî¥ SYNC ‡πÉ‡∏´‡∏°‡πà
  state.products = await API.fetchProducts();
  renderProducts();

  await renderAdminOrders();
};
</script>

<script>
function openAdminProductDetail(product) {
  state.selectedProduct = product;

  document.getElementById("edit-product-name").value =
    product.name || "";

  document.getElementById("edit-product-price").value =
    product.price || 0;

  document.getElementById("edit-product-image").value =
    product.image || "";

  document
    .getElementById("admin-product-detail-sheet")
    .classList.remove("hidden");
}

// ‚úÖ ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Å‡∏ß‡πà‡∏≤ (‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°)
const btnCloseProductDetail =
  document.getElementById("btn-close-product-detail");

if (btnCloseProductDetail) {
  btnCloseProductDetail.onclick = () => {
    document
      .getElementById("admin-product-detail-sheet")
      .classList.add("hidden");

    state.selectedProduct = null;
  };
}
</script>

  <script>
const stockSheet =
  document.getElementById("admin-stock-adjust-sheet");

const stockProductName =
  document.getElementById("stock-adjust-product-name");

const stockQtyInput =
  document.getElementById("stock-adjust-qty");

document.getElementById("btn-confirm-adjust-stock").onclick = async () => {
  const qty = Number(stockQtyInput.value);
  const type = document.querySelector(
    'input[name="stock-type"]:checked'
  ).value;

  const product = state.selectedProduct;
  if (!product) return;

  if (!qty || qty <= 0) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô");
    return;
  }

  // üîí guard ‡∏ù‡∏±‡πà‡∏á UI (‡∏Å‡∏±‡∏ô OUT ‡πÄ‡∏Å‡∏¥‡∏ô)
  if (type === "OUT" && qty > product.stock) {
    alert(`‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${product.stock})`);
    return;
  }

  try {
    const res = await API.adjustStock({
      productId: product.id,
      qty,
      type
    });

    if (!res.success) {
      alert(res.error || "‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      return;
    }

    // ‚úÖ ‡∏õ‡∏¥‡∏î popup
    stockSheet.classList.add("hidden");

    // üîÑ reload products ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å backend
    state.products = await API.fetchProducts();

    // üîÅ sync ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
    renderAdminProducts();
    renderProducts();

  } catch (err) {
    console.error(err);
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
  }
};

// ‡πÄ‡∏õ‡∏¥‡∏î popup
document.getElementById("btn-open-adjust-stock").onclick = () => {
  if (!state.selectedProduct) return;

  stockProductName.textContent =
    `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${state.selectedProduct.name}
     (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${state.selectedProduct.stock})`;

  stockQtyInput.value = "";
  stockSheet.classList.remove("hidden");
};

// ‡∏õ‡∏¥‡∏î popup
document.getElementById("btn-cancel-adjust-stock").onclick = () => {
  stockSheet.classList.add("hidden");
};
</script>

   <script>
const addProductSheet =
  document.getElementById("admin-add-product-sheet");

document.getElementById("btn-add-product").onclick = () => {
  clearAddProductForm();
  addProductSheet.classList.remove("hidden");
};

function clearAddProductForm() {
  document.getElementById("add-product-name").value = "";
  document.getElementById("add-product-price").value = "";
  document.getElementById("add-product-stock").value = "";
  document.getElementById("add-product-image").value = "";
  document.getElementById("add-product-preview").style.backgroundImage = "";
}
</script>

  <script>
document.getElementById("add-product-image").oninput = (e) => {
  document.getElementById("add-product-preview").style.backgroundImage =
    `url('${e.target.value}')`;
};
</script>

  <script>
document.getElementById("btn-create-product").onclick = async () => {
  const name  = document.getElementById("add-product-name").value.trim();
  const price = Number(document.getElementById("add-product-price").value);
  const stock = Number(document.getElementById("add-product-stock").value);
  const image = document.getElementById("add-product-image").value.trim();

  if (!name) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");
    return;
  }

  const res = await fetch(API_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "createProduct",
      payload: { name, price, stock, image }
    })
  }).then(r => r.json());

  if (!res.success) {
    alert(res.error || "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    return;
  }

  document
    .getElementById("admin-add-product-sheet")
    .classList.add("hidden");

  await renderAdminProducts(); // üî¥ refresh list
};
</script>


  
  <!-- ===============================
     INIT APP
     =============================== -->
<script>
  async function initApp() {
    try {
      state.products = await API.fetchProducts();
      renderProducts();
      renderCartIcon();
    } catch (e) {
      console.error(e);
      alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ");
    }
  }

  initApp();
   </script>

 </body>
</html>
