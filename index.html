<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Stock Management</title>

    <!-- ===============================
       UI STYLE (iOS 26 / Apple Style)
       =============================== -->
  <style>
    :root {
      --bg: linear-gradient(180deg, #f5f5f7 0%, #eaeaef 100%);
      --card: rgba(255,255,255,0.72);
      --blur: blur(22px);
      --text: #1c1c1e;
      --subtext: #6e6e73;
      --primary: #007aff;
      --danger: #ff3b30;
      --radius-lg: 22px;
      --radius-md: 16px;
      --shadow-soft: 0 8px 24px rgba(0,0,0,0.06);
      --shadow-card: 0 12px 32px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    h1 {
      font-size: 26px;
      margin-bottom: 12px;
    }

    h2 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    h3 {
      font-size: 17px;
      margin-bottom: 6px;
    }

    button {
      appearance: none;
      border: none;
      border-radius: 16px;
      padding: 14px 18px;
      font-size: 15px;
      font-weight: 600;
      background: var(--primary);
      color: #fff;
      box-shadow: var(--shadow-soft);
    }

    button.secondary {
      background: rgba(0,0,0,0.04);
      color: var(--text);
    }

    .hidden {
      display: none !important;
    }

    /* ===============================
       Layout
       =============================== */
    .app {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 16px 14px 32px;
    }

    /* ===============================
       Card (Glass)
       =============================== */
    .card {
      background: var(--card);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-card);
    }

    .muted {
      color: var(--subtext);
      font-size: 13px;
    }

    /* ===============================
   Product List
   =============================== */
#product-list {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-bottom: 20px;
}

.product-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  will-change: transform;
  gap: 12px;
  background: var(--card);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  border-radius: var(--radius-lg);
  padding: 14px 16px;
  box-shadow: var(--shadow-soft);
}

.product-card.selectable {
  cursor: pointer;
}

    .product-info {
      flex: 1;
    }

    .product-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .product-stock {
      font-size: 13px;
      color: var(--subtext);
    }

    .product-action {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(0,0,0,0.06);
      color: var(--text);
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: none;
    }

    /* ===============================
       Cart Summary
       =============================== */
    #cart-summary {
      position: sticky;
      bottom: 16px;
    }

    #cart-summary button {
      width: 100%;
      margin-top: 10px;
    }

        .cart-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ff3b30;
      color: #fff;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
    }


    /* ===============================
       Inputs (Admin)
       =============================== */
    input {
      width: 100%;
      padding: 14px 16px;
      border-radius: var(--radius-md);
      border: none;
      font-size: 15px;
      background: rgba(0,0,0,0.04);
      margin-bottom: 12px;
    }

        /* ===============================
       iOS Navigation Bar
       =============================== */
    .nav-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      margin: -16px -14px 16px;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-bottom: 1px solid rgba(0,0,0,0.04);
    }

    .nav-title {
      font-size: 17px;
      font-weight: 600;
      text-align: center;
      flex: 1;
    }

    .nav-action {
  position: relative; /* üî¥ CHANGED */
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(0,0,0,0.06);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
}


    .nav-spacer {
      width: 32px;
    }

        /* ===============================
       Empty State (Apple Style)
       =============================== */
    .empty-state {
      text-align: center;
      padding: 28px 16px;
      color: var(--subtext);
    }

    .empty-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 12px;
      border-radius: 50%;
      background: rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: var(--text);
    }

    .empty-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }

    .empty-desc {
      font-size: 13px;
      line-height: 1.4;
    }

        /* ===============================
       Admin Dashboard
       =============================== */
    .admin-section {
      margin-bottom: 24px;
    }

    .admin-section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--subtext);
      margin: 0 0 8px 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .admin-card {
      background: var(--card);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      border-radius: var(--radius-lg);
      padding: 16px;
      box-shadow: var(--shadow-card);
    }

    .admin-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }

    .admin-row:last-child {
      border-bottom: none;
    }

    .admin-row-label {
      font-size: 15px;
      font-weight: 500;
    }

    .admin-row-desc {
      font-size: 13px;
      color: var(--subtext);
      margin-top: 2px;
    }

    .admin-row-action {
      font-size: 18px;
      color: var(--subtext);
    }

        /* ===============================
       Motion & Interaction (iOS Feel)
       =============================== */

    /* Tap feedback */
    button,
    .product-card,
    .admin-card,
    .admin-row,
    .nav-action {
      transition:
        transform 0.12s ease,
        box-shadow 0.12s ease,
        background-color 0.12s ease,
        opacity 0.12s ease;
    }

    button:active,
    .product-card:active,
    .admin-card:active,
    .admin-row:active,
    .nav-action:active {
      transform: scale(0.98);
      opacity: 0.92;
    }

    /* Disabled button */
    button:disabled {
      background: rgba(0,0,0,0.12);
      color: rgba(0,0,0,0.35);
      box-shadow: none;
    }

    /* Hover hint (for desktop preview only) */
    @media (hover: hover) {
      .product-card:hover,
      .admin-row:hover {
        background: rgba(255,255,255,0.82);
      }
    }

    /* Page transition base */
    section {
      transition: opacity 0.25s ease, transform 0.25s ease;
    }

    section.hidden {
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
    }

    /* Nav action subtle feedback */
    .nav-action:active {
      background: rgba(0,0,0,0.12);
    }

        .sheet {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.25);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 50;
    }

    .sheet-card {
      width: 100%;
      max-width: 430px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-radius: 24px 24px 0 0;
      padding: 20px;
      box-shadow: var(--shadow-card);
      animation: slideUp 0.25s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

        /* ===============================
       Cart Item Control
       =============================== */
    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .cart-info {
      flex: 1;
    }

    .cart-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cart-actions button {
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 50%;
      background: rgba(0,0,0,0.06);
      color: var(--text);
      font-size: 18px;
      box-shadow: none;
    }

    .cart-actions .remove {
      color: var(--danger);
      font-weight: 700;
    }

  </style>

</head>

<body>
  <div class="app">

    <!-- ===============================
         VIEWER FLOW
         =============================== -->
    <section id="viewer-view">

            <!-- iOS Navigation Bar -->
      <!-- iOS Navigation Bar (Single Cart Source) -->
<div class="nav-bar">
  <div class="nav-action hidden" id="cart-icon">
    üß∫
    <span class="cart-badge">0</span>
  </div>

  <div class="nav-title">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>

  <div class="nav-action">‚ãØ</div>
</div>


      <h1 class="hidden">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

         <!-- Product List -->
<div id="product-list">

  <!-- Empty State (‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤) -->
  <div class="card empty-state">
    <div class="empty-icon">üì¶</div>
    <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
    <div class="empty-desc">
      ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    </div>
  </div>

  <!-- Product Card (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - UI ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ) -->
  <div class="product-card selectable hidden">
    <div class="product-info">
      <div class="product-name">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <div class="product-stock">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 120 ‡∏ä‡∏¥‡πâ‡∏ô</div>
    </div>
    <div class="product-action">‚Ä∫</div>
  </div>

</div>


        <!-- render product cards here -->
           
    </section>

    <section id="cart-view" class="hidden">
  <div class="nav-bar">
    <div class="nav-action" id="btn-back-cart">‚Äπ</div>
    <div class="nav-title">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>
    <div class="nav-spacer"></div>
  </div>

        <!-- Cart Summary -->
  <div class="card" id="cart-summary-box">
    <div><strong>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</strong></div>
    <div class="muted" id="cart-summary-text">
      -
    </div>
  </div>

  <div id="cart-items"></div>

  <button id="btn-go-order">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
</section>

    <!-- ===============================
         ORDER PREVIEW (PNG EXPORT)
         =============================== -->
    <section id="order-preview" class="hidden">

  <div class="card" id="order-sheet">
    <h2 style="text-align:center;margin-bottom:12px;">‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>

    <div class="muted" style="text-align:center;margin-bottom:16px;">
      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="order-date"></span>
    </div>

    <table style="width:100%;border-collapse:collapse;font-size:14px;">
      <thead>
        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);">
          <th align="left">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th align="center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th align="left">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</th>
        </tr>
      </thead>
      <tbody id="order-items"></tbody>
    </table>

    <div class="muted" style="margin-top:16px;text-align:center;">
      Generated by Stock System
    </div>
  </div>

  <button id="btn-export-png">Export PNG</button>
  <button class="secondary" id="btn-back-order">‡∏Å‡∏•‡∏±‡∏ö</button>


</section>


        <!-- ===============================
         ADMIN FLOW
         =============================== -->
    <section id="admin-login" class="hidden">
      <div class="card">
        <h2>Admin Login</h2>
        <input id="admin-password" type="password" placeholder="Password" />
        <button id="btn-admin-login">Login</button>
      </div>
    </section>

    <!-- üî¥ REPLACED: Admin Dashboard (UI Only) -->
    <section id="admin-dashboard" class="hidden">

      <!-- Admin Navigation -->
      <div class="nav-bar">
        <div class="nav-spacer"></div>
        <div class="nav-title">Admin</div>
        <div class="nav-action">‚ãØ</div>
      </div>

      <!-- ===============================
           Product Management
           =============================== -->
      <div class="admin-section">
        <div class="admin-section-title">Products</div>

        <div class="admin-card">
          <div class="admin-row">
            <div>
              <div class="admin-row-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
              <div class="admin-row-desc">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
            </div>
            <div class="admin-row-action">‚Ä∫</div>
          </div>

          <div id="admin-product-list">
            <div class="empty-state">
              <div class="empty-icon">üì¶</div>
              <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
              <div class="empty-desc">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å
              </div>
            </div>
          </div>

          <button id="btn-add-product" style="margin-top:12px;">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          </button>
        </div>
      </div>

      <!-- ===============================
           Stock Movement
           =============================== -->
      <div class="admin-section">
        <div class="admin-section-title">Stock</div>

        <div class="admin-card">
          <div class="admin-row">
            <div>
              <div class="admin-row-label">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ / ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</div>
              <div class="admin-row-desc">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏ï‡πä‡∏≠‡∏Å</div>
            </div>
            <div class="admin-row-action">‚Ä∫</div>
          </div>

          <div class="empty-state">
            <div class="empty-icon">üîÑ</div>
            <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
            <div class="empty-desc">
              ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            </div>
          </div>
        </div>
      </div>

      <!-- ===============================
           History
           =============================== -->
      <div class="admin-section">
        <div class="admin-section-title">History</div>

        <div class="admin-card">
          <div class="empty-state">
            <div class="empty-icon">üïò</div>
            <div class="empty-title">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
            <div class="empty-desc">
              ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </div>
          </div>
        </div>
      </div>

      
    </section>

     </div> <!-- üî¥ FIX: close .app -->
  
<!-- ===============================
     Add to Cart Sheet (UI Only)
     =============================== -->
<div id="add-to-cart-sheet" class="sheet hidden">
  <div class="sheet-card">
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</label>
    <input type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10" />

    <label>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</label>
    <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á" />

    <button id="btn-add-to-cart">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
<button class="secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>

  </div>
</div>
  
  <!-- ===============================
       GLOBAL STATE
       =============================== -->
  <script>
  const state = {
    products: [
      // mock data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö STEP 3
      { id: 1, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A", stock: 120 },
      { id: 2, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B", stock: 80 }
    ],
    cart: [],
    selectedProduct: null,
    admin: {
      loggedIn: false
    }
  };
</script>


  <!-- ===============================
       API LAYER (Google Apps Script)
       =============================== -->
  <script>
    const API = {
      fetchProducts() {},
      createProduct() {},
      updateProduct() {},
      stockIn() {},
      stockOut() {},
      fetchStockHistory() {}
    };
  </script>

  <!-- ===============================
       RENDER FUNCTIONS
       =============================== -->
  <script>
  function renderCartSummary() {
    const summary = document.getElementById("cart-summary-text");
    const btnOrder = document.getElementById("btn-go-order");

    const totalItems = state.cart.length;
    const totalQty = state.cart.reduce((sum, i) => sum + i.qty, 0);

    if (totalItems === 0) {
      summary.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤";
      btnOrder.disabled = true;           // üî¥ GUARD
      return;
    }

    summary.textContent =
      `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ¬∑ ‡∏£‡∏ß‡∏° ${totalQty} ‡∏ä‡∏¥‡πâ‡∏ô`;

    btnOrder.disabled = false;
  }
</script>

  <script>
  function renderProducts() {
    const list = document.getElementById("product-list");
    list.innerHTML = "";

    if (state.products.length === 0) {
      list.innerHTML = `
        <div class="card empty-state">
          <div class="empty-icon">üì¶</div>
          <div class="empty-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        </div>`;
      return;
    }

    state.products.forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card selectable";
      card.innerHTML = `
        <div class="product-info">
          <div class="product-name">${p.name}</div>
          <div class="product-stock">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${p.stock} ‡∏ä‡∏¥‡πâ‡∏ô</div>
        </div>
        <div class="product-action">‚Ä∫</div>
      `;

      card.onclick = () => openAddToCartSheet(p);
      list.appendChild(card);
    });
  }

  function renderCartIcon() {
    const icon = document.getElementById("cart-icon");
    const badge = icon.querySelector(".cart-badge");

    if (state.cart.length === 0) {
      icon.classList.add("hidden");
      return;
    }

    icon.classList.remove("hidden");
    const totalQty = state.cart.reduce((sum, i) => sum + i.qty, 0);
badge.textContent = totalQty;

  }
</script>

 <script>
  function renderCart() {
    const box = document.getElementById("cart-items");
    box.innerHTML = "";

    // üî¥ GUARD: cart ‡∏ß‡πà‡∏≤‡∏á ‚Üí ‡∏Å‡∏•‡∏±‡∏ö viewer
    if (state.cart.length === 0) {
      document.getElementById("cart-view").classList.add("hidden");
      document.getElementById("viewer-view").classList.remove("hidden");
      renderCartIcon();
      return;
    }

    state.cart.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "card cart-item";

      div.innerHTML = `
        <div class="cart-info">
          <strong>${item.name}</strong><br/>
          ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á: ${item.user}
        </div>

        <div class="cart-actions">
          <button data-action="decrease">‚àí</button>
          <span>${item.qty}</span>
          <button data-action="increase">+</button>
          <button class="remove" data-action="remove">√ó</button>
        </div>
      `;

      div.onclick = (e) => {
        const action = e.target.getAttribute("data-action");
        if (!action) return;

        if (action === "increase") item.qty++;
        if (action === "decrease") {
          item.qty--;
          if (item.qty <= 0) state.cart.splice(index, 1);
        }
        if (action === "remove") state.cart.splice(index, 1);

        renderCart();
        renderCartIcon();
      };

      box.appendChild(div);
    });

    // üî¥ CHANGED: update summary ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    renderCartSummary();
  }
</script>

  <script>
  function renderOrderSheet() {
    const body = document.getElementById("order-items");
    body.innerHTML = "";

    const dateEl = document.getElementById("order-date");
    dateEl.textContent = new Date().toLocaleString("th-TH");

    state.cart.forEach(item => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td style="padding:6px 0;">${item.name}</td>
        <td align="center">${item.qty}</td>
        <td>${item.user}</td>
      `;
      body.appendChild(tr);
    });
  }
</script>




  <!-- ===============================
     VIEWER FLOW LOGIC
     =============================== -->
<script>
  const sheet = document.getElementById("add-to-cart-sheet");
  const qtyInput = sheet.querySelector('input[type="number"]');
  const userInput = sheet.querySelector('input[type="text"]');
  const addBtn = document.getElementById("btn-add-to-cart"); // üî¥ CHANGED
  const cancelBtn = sheet.querySelector(".secondary");

  function openAddToCartSheet(product) {
    state.selectedProduct = product;
    qtyInput.value = "";
    userInput.value = "";
    sheet.classList.remove("hidden");
  }

    function closeSheet() {
    sheet.classList.add("hidden");
    state.selectedProduct = null;

    // üî¥ OPTIONAL: defensive clear
    qtyInput.value = "";
    userInput.value = "";
  }

 addBtn.onclick = () => {
  const qty = Number(qtyInput.value);
  const user = userInput.value.trim();

  if (!qty || qty <= 0 || !user) {
    alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á");
    return;
  }

  const product = state.selectedProduct;

  // üî¥ NORMALIZE: ‡∏´‡∏≤ item ‡πÄ‡∏î‡∏¥‡∏° (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô + ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
  const existing = state.cart.find(
    i => i.productId === product.id && i.user === user
  );

  if (existing) {
    existing.qty += qty; // ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  } else {
    state.cart.push({
      productId: product.id,
      name: product.name,
      qty,
      user
    });
  }

  closeSheet();
  renderCartIcon();
};


  cancelBtn.onclick = closeSheet;
</script>

 <script>
  // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Order Preview
  document.getElementById("btn-go-order").onclick = () => {
    if (state.cart.length === 0) return; // üîí guard ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

    document.getElementById("cart-view").classList.add("hidden");
    document.getElementById("order-preview").classList.remove("hidden");

    renderOrderSheet(); // üî¥ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  };

  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏≤‡∏Å icon
  document.getElementById("cart-icon").onclick = () => {
    if (state.cart.length === 0) return; // üîí guard

    document.getElementById("viewer-view").classList.add("hidden");
    document.getElementById("cart-view").classList.remove("hidden");

    renderCart();
  };

   // üî¥ ADD THIS: ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Cart ‚Üí Viewer
  document.getElementById("btn-back-cart").onclick = () => {
    document.getElementById("cart-view").classList.add("hidden");
    document.getElementById("viewer-view").classList.remove("hidden");
  };
   
  // ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Order ‚Üí Cart
  document.getElementById("btn-back-order").onclick = () => {
    document.getElementById("order-preview").classList.add("hidden");
    document.getElementById("cart-view").classList.remove("hidden");
  };
</script>


<script>
  document.getElementById("btn-export-png").onclick = () => {
    const node = document.getElementById("order-sheet");

    const rect = node.getBoundingClientRect();
    const scale = 2;

    const canvas = document.createElement("canvas");
    canvas.width = rect.width * scale;
    canvas.height = rect.height * scale;

    const ctx = canvas.getContext("2d");
    ctx.scale(scale, scale);

    const data = `
      <svg xmlns="http://www.w3.org/2000/svg" width="${rect.width}" height="${rect.height}">
        <foreignObject width="100%" height="100%">
          ${new XMLSerializer().serializeToString(node)}
        </foreignObject>
      </svg>
    `;

    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 0, 0);
      const link = document.createElement("a");
      link.download = "order.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    };

    img.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(data);
  };
</script>




  <!-- ===============================
       ADMIN FLOW LOGIC
       =============================== -->
  <script>
    document.getElementById("btn-admin-login").onclick = () => {
      state.admin.loggedIn = true;
      document.getElementById("admin-login").classList.add("hidden");
      document.getElementById("admin-dashboard").classList.remove("hidden");
    };
  </script>

  
  <!-- ===============================
     INIT APP
     =============================== -->
<script>
  function initApp() {
    renderProducts();
    renderCartIcon();
  }

  initApp();
</script>


</body>
</html>
